# üì± PRD - Sistema de Notifica√ß√£o de Atualiza√ß√£o de Vers√£o

**Data de Cria√ß√£o:** 24 de outubro de 2025  
**Vers√£o do Documento:** 2.0.0  
**Status:** ‚úÖ Aprovado  
**Respons√°vel:** Equipe de Desenvolvimento  
**Vers√£o:** Completamente Automatizada via CI/CD + Semantic Release  

---

## üìã Sum√°rio Executivo

Este PRD descreve a implementa√ß√£o de um **sistema inteligente e totalmente automatizado de notifica√ß√£o de atualiza√ß√£o de vers√£o** para o aplicativo Garagem Inteligente. O sistema utiliza **Semantic Release + CI/CD Automatizado** para:

1. **Gerar vers√µes automaticamente** baseado em commits convencionais (fix/feat/breaking)
2. **Atualizar Firestore instantaneamente** ap√≥s cada release
3. **Notificar usu√°rios** sem qualquer interven√ß√£o manual do desenvolvedor

**Fluxo Simplificado:** Merge PR na main ‚Üí GitHub Actions automatiza tudo ‚Üí Usu√°rios recebem notifica√ß√£o em < 5 minutos

### Objetivos Principais
- ‚úÖ **Automatizar 100%** a gera√ß√£o de vers√£o e notifica√ß√£o (ZERO manual)
- ‚úÖ **Implementar Semantic Versioning** baseado em commits convencionais
- ‚úÖ **Notificar usu√°rios** em tempo real sem bloqueio de acesso
- ‚úÖ **Integrar CI/CD** com semantic-release + GitHub Actions + Firebase
- ‚úÖ **Gerar changelog autom√°tico** a partir de commits
- ‚úÖ **Oferecer controle opcional** (pode alterar isCritical manualmente se necess√°rio)
- ‚úÖ **Manter experi√™ncia UX** intuitiva e n√£o-intrusiva

---

## üéØ Escopo da Feature

### Inclu√≠do ‚úÖ

#### Frontend (Dentro da app)
- Sistema de verifica√ß√£o de vers√£o ao abrir o app
- Banner persistente de notifica√ß√£o em tela
- Integra√ß√£o com Firebase Firestore para configura√ß√£o de vers√µes
- Modal de informa√ß√µes sobre atualiza√ß√£o (com changelog)
- Hist√≥rico de dismiss√£o de notifica√ß√µes (localStorage)
- Verifica√ß√£o peri√≥dica autom√°tica (24h)
- Redirecionamento direto para Play Store
- Testes unit√°rios completos

#### Backend (CI/CD - GitHub Actions)
- **Semantic Release autom√°tico** baseado em commits convencionais
- **An√°lise de commits** (fix ‚Üí patch, feat ‚Üí minor, breaking ‚Üí major)
- **Gera√ß√£o autom√°tica de CHANGELOG.md**
- **Versionamento autom√°tico** de todos os arquivos
- **Build Android autom√°tico** com vers√£o correta
- **Upload para Play Store** (Beta/Production)
- **Atualiza√ß√£o autom√°tica do Firestore** com nova vers√£o
- **Zero interven√ß√£o manual** ap√≥s merge

### N√£o Inclu√≠do ‚ùå
- Bloqueio for√ßado do app (mant√©m design n√£o-intrusivo)
- Download autom√°tico de APK
- Atualiza√ß√£o OTA (Over-The-Air) - futuro v2.0
- Integra√ß√£o com App Store - apenas Play Store nesta vers√£o
- Notifica√ß√µes push - futuro v2.0
- Rollout gradual por percentual - futuro v2.0

---

## üé® Design & Visual

### Padr√£o de Design Utilizado
O sistema de atualiza√ß√£o segue os **padr√µes visuais da ProfilePage** com as seguintes caracter√≠sticas:

| Elemento | Descri√ß√£o | Aplica√ß√£o |
|----------|-----------|-----------|
| **Glassmorphism** | Backdrop blur com transpar√™ncia | Banner background |
| **Gradientes** | Linear gradients (135deg) | √çcone warning + background |
| **Cards** | Bordas rounded (16px), shadows | Container de notifica√ß√£o |
| **Tipografia** | SF Pro Display, pesos 400-600 | Textos informativos |
| **Espa√ßamento** | Grid 8px | Padding/margins |
| **Cores** | CSS Variables (--ion-color-*) | Consist√™ncia com app |

### Componentes Visuais

#### 1. **Update Banner** (Tela Principal)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è  Atualiza√ß√£o Dispon√≠vel                           ‚úï  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Atualize para a vers√£o 1.0.1 para melhor experi√™ncia   ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ [  Depois  ]  [  Atualizar Agora  ]                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Localiza√ß√£o:** Topo da HomePage, logo ap√≥s ModernHeader  
**Altura:** 120px (expandido com a√ß√µes)  
**Cores:**
- Background: `linear-gradient(135deg, var(--ion-color-warning), var(--ion-color-warning-tint))`
- Texto: `var(--ion-color-warning-contrast)` (branco/cinza escuro)
- Icone: Warning/Alert da Ionicons

**Comportamento:**
- Aparece ao montar HomePage se houver atualiza√ß√£o dispon√≠vel
- Pode ser dismissido por 12 horas
- Ressurge ap√≥s per√≠odo de dismiss√£o
- Anima com slide-down ao aparecer

#### 2. **Update Information Modal** (Modal de Detalhes)

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üîÑ Atualiza√ß√£o Dispon√≠vel             ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                        ‚ïë
‚ïë  Vers√£o Atual: 1.0.0                   ‚ïë
‚ïë  Nova Vers√£o:  1.0.1                   ‚ïë
‚ïë                                        ‚ïë
‚ïë  Melhorias:                             ‚ïë
‚ïë  ‚Ä¢ Corre√ß√£o de bugs                    ‚ïë
‚ïë  ‚Ä¢ Melhor performance                  ‚ïë
‚ïë  ‚Ä¢ Novas funcionalidades               ‚ïë
‚ïë                                        ‚ïë
‚ïë [  Cancelar  ]  [  Atualizar  ]        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**Tipo:** Ion Modal  
**Acionador:** Clique em "Detalhes" do banner (futuro)  
**Conte√∫do:** Changelog extra√≠do do Firebase

#### 3. **Version Info no Perfil** (Tela de Perfil)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Sobre o Aplicativo                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Vers√£o Instalada:      1.0.0          [‚úì Atualizado]   ‚îÇ
‚îÇ  √öltima Verifica√ß√£o:    h√° 2 horas                       ‚îÇ
‚îÇ  Status:                Atualizado                       ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ                [ Verificar Atualiza√ß√µes ]                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ü§ñ Automatiza√ß√£o do CI/CD (O Grande Destaque!)

### Fluxo Completamente Automatizado

**O que muda para voc√™:**
- ‚úÖ Voc√™ **n√£o faz nada manualmente** ap√≥s merge
- ‚úÖ Vers√£o √© **calculada automaticamente** de commits
- ‚úÖ Firestore √© **atualizado instantaneamente**
- ‚úÖ Changelog √© **gerado de commits reais**
- ‚úÖ Tudo pronto em **< 5 minutos**

### Conven√ß√£o de Commits (Semantic Release)

Para a automa√ß√£o funcionar, commits devem seguir padr√£o:

```bash
# üêõ Bugfix ‚Üí Vers√£o 1.0.0 ‚Üí 1.0.1 (patch)
git commit -m "fix: corrige crash ao salvar ve√≠culo"

# ‚ú® Nova Feature ‚Üí Vers√£o 1.0.0 ‚Üí 1.1.0 (minor)
git commit -m "feat: adiciona filtro por combust√≠vel"

# üî® Refatora√ß√£o ‚Üí Sem vers√£o
git commit -m "refactor: reorganiza componentes"

# ‚ö†Ô∏è BREAKING CHANGE ‚Üí Vers√£o 1.0.0 ‚Üí 2.0.0 (major)
git commit -m "feat: novo sistema de autentica√ß√£o

BREAKING CHANGE: API de auth completamente refatorada"
```

### Arquitetura do CI/CD

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Voc√™ faz commits convencionais + PR ‚Üí Merge          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. GitHub Actions dispara (release.yml)                ‚îÇ
‚îÇ    ‚îú‚îÄ Setup Node + pnpm                               ‚îÇ
‚îÇ    ‚îú‚îÄ pnpm install + type-check + lint                ‚îÇ
‚îÇ    ‚îú‚îÄ pnpm build (Vue ‚Üí JS)                           ‚îÇ
‚îÇ    ‚îî‚îÄ ü§ñ semantic-release                             ‚îÇ
‚îÇ       ‚îú‚îÄ Analisa commits                               ‚îÇ
‚îÇ       ‚îú‚îÄ Calcula vers√£o (1.0.0 ‚Üí 1.1.0)              ‚îÇ
‚îÇ       ‚îú‚îÄ Gera CHANGELOG.md                             ‚îÇ
‚îÇ       ‚îú‚îÄ Atualiza src/version.json                     ‚îÇ
‚îÇ       ‚îú‚îÄ Faz commit + push (tag v1.1.0)               ‚îÇ
‚îÇ       ‚îî‚îÄ Dispara scripts autom√°ticos                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. Build Android Autom√°tico                            ‚îÇ
‚îÇ    ‚îú‚îÄ ./scripts/build-android.sh                       ‚îÇ
‚îÇ    ‚îú‚îÄ L√™ vers√£o de src/version.json                    ‚îÇ
‚îÇ    ‚îú‚îÄ Build APK/AAB com vers√£o correta                ‚îÇ
‚îÇ    ‚îî‚îÄ Upload para Play Store (Beta/Production)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. üîî Atualizar Firebase (Autom√°tico)                  ‚îÇ
‚îÇ    ‚îú‚îÄ scripts/publish-version.js                       ‚îÇ
‚îÇ    ‚îú‚îÄ Conecta ao Firestore                             ‚îÇ
‚îÇ    ‚îú‚îÄ Extrai changelog de CHANGELOG.md                 ‚îÇ
‚îÇ    ‚îú‚îÄ Atualiza app-config/version:                    ‚îÇ
‚îÇ    ‚îÇ  ‚îú‚îÄ currentVersion: vers√£o anterior               ‚îÇ
‚îÇ    ‚îÇ  ‚îú‚îÄ latestVersion: v1.1.0                         ‚îÇ
‚îÇ    ‚îÇ  ‚îú‚îÄ changelog: itens extra√≠dos                    ‚îÇ
‚îÇ    ‚îÇ  ‚îú‚îÄ isCritical: false (padr√£o)                   ‚îÇ
‚îÇ    ‚îÇ  ‚îî‚îÄ releaseDate: agora                            ‚îÇ
‚îÇ    ‚îî‚îÄ ‚úÖ COMPLETO!                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. üì± Usu√°rios Notificados                             ‚îÇ
‚îÇ    ‚îú‚îÄ Pr√≥xima abertura do app                          ‚îÇ
‚îÇ    ‚îú‚îÄ useAppVersion detecta: 1.0.0 < 1.1.0           ‚îÇ
‚îÇ    ‚îú‚îÄ Banner aparece com changelog                     ‚îÇ
‚îÇ    ‚îî‚îÄ Fluxo de atualiza√ß√£o inicia                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Scripts de Automa√ß√£o Necess√°rios

#### 1. `.releaserc.json` (Configura√ß√£o Semantic Release)

```json
{
  "branches": ["main"],
  "plugins": [
    ["@semantic-release/commit-analyzer", {
      "preset": "conventionalcommits"
    }],
    ["@semantic-release/release-notes-generator", {
      "preset": "conventionalcommits"
    }],
    ["@semantic-release/changelog", {
      "changelogFile": "CHANGELOG.md"
    }],
    ["@semantic-release/exec", {
      "prepareCmd": "node scripts/update-version.js ${nextRelease.version}"
    }],
    ["@semantic-release/exec", {
      "publishCmd": "node scripts/publish-version.js ${nextRelease.version}"
    }],
    ["@semantic-release/git", {
      "assets": ["package.json", "src/version.json", "CHANGELOG.md"],
      "message": "chore(release): ${nextRelease.version} [skip ci]"
    }]
  ]
}
```

#### 2. `scripts/update-version.js` (Atualiza arquivos locais)

```javascript
#!/usr/bin/env node

const fs = require('fs')
const path = require('path')

const newVersion = process.argv[2]

if (!newVersion) {
  console.error('Vers√£o n√£o fornecida')
  process.exit(1)
}

// Atualizar src/version.json
const versionFile = path.join(__dirname, '../src/version.json')
const versionData = {
  version: newVersion,
  buildNumber: Math.floor(Date.now() / 1000),
  releaseDate: new Date().toISOString(),
  changelog: []
}

fs.writeFileSync(versionFile, JSON.stringify(versionData, null, 2))

// Atualizar package.json
const packageFile = path.join(__dirname, '../package.json')
const packageData = JSON.parse(fs.readFileSync(packageFile, 'utf-8'))
packageData.version = newVersion
fs.writeFileSync(packageFile, JSON.stringify(packageData, null, 2))

console.log(`‚úÖ Vers√£o atualizada para ${newVersion}`)
```

#### 3. `scripts/publish-version.js` (Atualiza Firestore)

```javascript
#!/usr/bin/env node

const admin = require('firebase-admin')
const fs = require('fs')
const path = require('path')

// Inicializar Firebase Admin
const serviceAccount = JSON.parse(
  process.env.FIREBASE_SERVICE_ACCOUNT ||
  fs.readFileSync(path.join(__dirname, '../firebase-key.json'), 'utf-8')
)

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: process.env.VITE_FIREBASE_DATABASE_URL
})

const db = admin.firestore()
const newVersion = process.argv[2]

async function publishVersion() {
  try {
    const versionFile = path.join(__dirname, '../src/version.json')
    const changelogFile = path.join(__dirname, '../CHANGELOG.md')

    const changelog = fs.readFileSync(changelogFile, 'utf-8')
    
    // Extrair mudan√ßas do primeiro release
    const lines = changelog.split('\n')
    const changelogLines = []
    let started = false
    
    for (const line of lines) {
      if (line.startsWith('## ') && started) break
      if (line.startsWith('## ')) started = true
      if (started && line.trim() && !line.startsWith('##')) {
        const cleaned = line.replace(/^- /, '').trim()
        if (cleaned) changelogLines.push(cleaned)
      }
    }

    // Buscar vers√£o anterior
    const configRef = db.collection('app-config').doc('version')
    const currentDoc = await configRef.get()
    const previousVersion = currentDoc.exists ? currentDoc.data().latestVersion : '0.0.0'

    // Atualizar Firestore
    await configRef.set({
      currentVersion: previousVersion,
      latestVersion: newVersion,
      updateUrl: `https://play.google.com/store/apps/details?id=${process.env.ANDROID_PACKAGE_ID || 'com.garagem.inteligente'}`,
      changelog: changelogLines,
      releaseDate: admin.firestore.Timestamp.now(),
      isCritical: false,
      createdAt: admin.firestore.Timestamp.now(),
      updatedAt: admin.firestore.Timestamp.now(),
      updatedBy: 'automatic-ci-release'
    }, { merge: false })

    console.log(`‚úÖ Firestore atualizado com vers√£o ${newVersion}`)
    console.log(`ÔøΩ Changelog: ${changelogLines.length} itens`)
  } catch (error) {
    console.error('‚ùå Erro ao publicar vers√£o:', error)
    process.exit(1)
  }
}

publishVersion()
```

#### 4. `.github/workflows/release.yml` (GitHub Actions)

```yaml
name: Semantic Release & Build

on:
  push:
    branches:
      - main

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Type check
        run: pnpm type-check
      
      - name: Lint
        run: pnpm lint
      
      - name: Build
        run: pnpm build
      
      - name: ü§ñ Semantic Release
        uses: cycjimmy/semantic-release-action@v4
        with:
          semantic_version: 21.1.1
          extra_plugins: |
            @semantic-release/changelog
            @semantic-release/exec
            @semantic-release/git
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GIT_AUTHOR_NAME: 'GitHub Actions'
          GIT_AUTHOR_EMAIL: 'actions@github.com'
          GIT_COMMITTER_NAME: 'GitHub Actions'
          GIT_COMMITTER_EMAIL: 'actions@github.com'
      
      - name: üì§ Build Android
        run: ./scripts/build-android.sh
        env:
          VITE_APP_VERSION: ${{ env.NEXTRELEASE_VERSION }}
      
      - name: üîî Publish to Firebase
        run: node scripts/publish-version.js ${{ env.NEXTRELEASE_VERSION }}
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_JSON }}
          ANDROID_PACKAGE_ID: 'com.garagem.inteligente'
```

---

## üèóÔ∏è Arquitetura T√©cnica

### Stack Tecnol√≥gico
- **Vue 3** (Composition API)
- **TypeScript** (tipagem strict)
- **Ionic Vue** (componentes UI)
- **Pinia** (state management)
- **Firebase Firestore** (configura√ß√£o de vers√µes)
- **SCSS** (estilos scoped)

### Diagrama de Fluxo

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          App Inicializado (App.vue)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  shouldCheckVersion? ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ SIM   ‚îÇ N√ÉO ‚îÇ
            ‚ñº      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ fetchVersionConfig ‚îÇ (Firestore)
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ compareVersions()  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Atualizado? ‚îÇ
      ‚ñº           ‚ñº
     SIM         N√ÉO
      ‚îÇ           ‚îÇ
      ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ      ‚îÇ initVersionCheck() ‚îÇ
      ‚îÇ      ‚îÇ setLastCheckTime() ‚îÇ
      ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ               ‚îÇ
      ‚îÇ               ‚ñº
      ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ      ‚îÇ renderUpdateBanner ‚îÇ
      ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚îî‚îÄ‚îÄ‚ñ∫ continuar acesso normal
```

### Estrutura de Arquivos

```
src/
‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îî‚îÄ‚îÄ useAppVersion.ts              ‚Üê L√≥gica de vers√£o
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ appVersion.ts                 ‚Üê Pinia store
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ version.ts                    ‚Üê Interfaces TypeScript
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ versionComparison.ts          ‚Üê Utilit√°rios de vers√£o
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ home-page/
‚îÇ       ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ UpdateBanner.vue      ‚Üê Banner de notifica√ß√£o
‚îÇ       ‚îî‚îÄ‚îÄ home-page.vue             ‚Üê HomePage modificada
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ unit/
        ‚îú‚îÄ‚îÄ useAppVersion.spec.ts     ‚Üê Testes do composable
        ‚îú‚îÄ‚îÄ appVersion.spec.ts        ‚Üê Testes do store
        ‚îî‚îÄ‚îÄ UpdateBanner.spec.ts      ‚Üê Testes do componente

firebase/
‚îî‚îÄ‚îÄ firestore/
    ‚îî‚îÄ‚îÄ collections/
        ‚îî‚îÄ‚îÄ app-config/version/       ‚Üê Documento de configura√ß√£o
```

---

## üîß Especifica√ß√µes T√©cnicas Detalhadas

### 1. Composable: `useAppVersion.ts`

**Responsabilidade:** Gerenciar l√≥gica de verifica√ß√£o de vers√£o

**M√©todos P√∫blicos:**

```typescript
interface UseAppVersion {
  // Refs reativas
  currentVersion: Ref<string>
  latestVersion: Ref<string | null>
  minimumVersion: Ref<string | null>
  updateUrl: Ref<string | null>
  loading: Ref<boolean>
  error: Ref<string | null>
  
  // Computed properties
  isOutdated: ComputedRef<boolean>           // v1 < v2
  hasUpdateAvailable: ComputedRef<boolean>   // v1 < latest
  
  // M√©todos
  fetchVersionConfig(): Promise<boolean>     // Busca do Firestore
  compareVersions(v1: string, v2: string): boolean  // Compara√ß√£o sem√¢ntica
  openPlayStore(): void                      // Abre link Play Store
}
```

**Detalhes da Compara√ß√£o de Vers√µes:**

```typescript
// Compara√ß√£o sem√¢ntica de vers√µes (SemVer)
compareVersions('1.0.0', '1.0.1') // true (1.0.0 < 1.0.1)
compareVersions('1.0.0', '1.1.0') // true
compareVersions('1.0.0', '2.0.0') // true
compareVersions('1.0.0', '1.0.0') // false (iguais)
compareVersions('1.0.0', '0.9.0') // false (1.0.0 > 0.9.0)
```

### 2. Store Pinia: `appVersion.ts`

**Responsabilidade:** Gerenciar estado global de atualiza√ß√£o

**State:**

```typescript
{
  dismissedUntil: number | null        // Timestamp de dismiss√£o
  lastCheckTime: number | null         // Timestamp da √∫ltima verifica√ß√£o
  forceCheckFlag: boolean              // Flag para for√ßar check
}
```

**Getters:**

```typescript
{
  isBannerDismissed: boolean           // Banner foi dismissido?
  shouldCheckVersion: boolean          // Passou 24h desde check?
  hasOutstandingUpdate: boolean        // H√° atualiza√ß√£o pendente?
}
```

**Actions:**

```typescript
{
  initVersionCheck()                   // Inicializa verifica√ß√£o
  dismissBanner()                      // Dismissir por 12h
  forceCheck()                         // For√ßa nova verifica√ß√£o
  resetDismissal()                     // Limpa dismiss√£o
}
```

### 3. Componente: `UpdateBanner.vue`

**Props:** Nenhuma (usa composable/store diretamente)

**Events:** Nenhum (emite via store)

**Template Structure:**

```
<transition name="slide-down">
  <div class="update-banner" v-if="showBanner && isOutdated">
    <div class="update-banner__content">
      <div class="update-banner__icon">
      <div class="update-banner__text">
      <button class="update-banner__close">
    
    <div class="update-banner__actions">
      <ion-button slot="cancel" @click="dismiss">
      <ion-button slot="confirm" @click="update">
</transition>
```

**Comportamento:**
- S√≥ renderiza se `isOutdated === true` e `!isBannerDismissed`
- Anima entrada/sa√≠da com transition `slide-down`
- Dismiss√£o autom√°tica de 12 horas
- Trata cliques em "Atualizar" abrindo Play Store

### 4. Documento Firestore: `app-config/version`

**Localiza√ß√£o:** `app-config/version`

**Schema:**

```typescript
interface VersionConfig {
  // Vers√µes (sem√¢ntica)
  currentVersion: string              // "1.0.0" (m√≠nimo suportado)
  latestVersion: string               // "1.0.1" (recomendado)
  
  // URLs e Links
  updateUrl: string                   // "https://play.google.com/store/apps/details?id=com.garagem.inteligente"
  
  // Metadados
  changelog?: string[]                // ["Corre√ß√£o de bugs", "Melhor performance"]
  releaseDate?: Timestamp             // Data do lan√ßamento
  isCritical?: boolean                // Para vers√µes futuras (force update)
  
  // Admin
  createdAt: Timestamp
  updatedAt: Timestamp
  updatedBy: string                   // Email do admin que atualizou
}
```

**Exemplo de Documento:**

```json
{
  "currentVersion": "1.0.0",
  "latestVersion": "1.0.1",
  "updateUrl": "https://play.google.com/store/apps/details?id=com.garagem.inteligente",
  "changelog": [
    "Corre√ß√£o de crashes no upload de imagens",
    "Melhor performance de listagem de manuten√ß√µes",
    "Novo filtro por tipo de combust√≠vel"
  ],
  "releaseDate": "2025-10-24T10:30:00Z",
  "isCritical": false,
  "createdAt": "2025-10-24T10:30:00Z",
  "updatedAt": "2025-10-24T10:30:00Z",
  "updatedBy": "admin@garagem.app"
}
```

---

## üì± Fluxo do Usu√°rio (UX Flow) com Automatiza√ß√£o

### Cen√°rio Real: Desenvolvimento ‚Üí Release ‚Üí Notifica√ß√£o

#### Fase 1: Voc√™ Fazendo Desenvolvimento (Seu Trabalho)

```
1. Voc√™ fixa bug de crash no upload
   git commit -m "fix: corrige crash ao fazer upload de foto"
   git push origin feature-branch
   
2. Voc√™ cria PR ‚Üí Revis√£o ‚Üí Merge na main
   Pull Request aprovada
   Merge realizado

3. üéØ Aqui termina seu trabalho!
```

#### Fase 2: CI/CD Autom√°tico (Sem Sua Interven√ß√£o)

```
4. ü§ñ GitHub Actions dispara automaticamente:
   ‚îú‚îÄ Setup Node + pnpm
   ‚îú‚îÄ pnpm install + type-check + lint
   ‚îú‚îÄ pnpm build (Vue ‚Üí JavaScript)
   ‚îú‚îÄ ‚úÖ Tudo passou!
   
5. ü§ñ semantic-release analisa seus commits:
   ‚îú‚îÄ Detecta: "fix: corrige crash"
   ‚îú‚îÄ Calcula: 1.0.0 ‚Üí 1.0.1 (patch)
   ‚îú‚îÄ Gera: CHANGELOG.md
   ‚îú‚îÄ Atualiza: src/version.json
   ‚îú‚îÄ Tag Git: v1.0.1 (criada automaticamente)
   
6. ü§ñ Build Android autom√°tico:
   ‚îú‚îÄ L√™ vers√£o: 1.0.1
   ‚îú‚îÄ Build APK/AAB
   ‚îú‚îÄ Upload para Play Store Beta
   
7. ü§ñ Script publish-version.js:
   ‚îú‚îÄ Conecta ao Firebase Firestore
   ‚îú‚îÄ Extrai changelog de CHANGELOG.md
   ‚îú‚îÄ Atualiza app-config/version:
   ‚îÇ  ‚îú‚îÄ currentVersion: "1.0.0"
   ‚îÇ  ‚îú‚îÄ latestVersion: "1.0.1"
   ‚îÇ  ‚îú‚îÄ changelog: ["Corre√ß√£o de crash ao fazer upload"]
   ‚îÇ  ‚îú‚îÄ isCritical: false (padr√£o)
   ‚îÇ  ‚îî‚îÄ releaseDate: agora
   
‚úÖ TUDO FEITO EM < 5 MINUTOS (AUTOMATICAMENTE!)
```

### Cen√°rio 1: Usu√°rio Abre App com Update Dispon√≠vel

```
8. üì± Usu√°rio abre app (vers√£o 1.0.0 instalada)
   
9. App.vue ‚Üí useAppVersionStore.initVersionCheck()
   ‚îî‚îÄ Conecta ao Firestore
   ‚îî‚îÄ L√™: latestVersion = "1.0.1"
   ‚îî‚îÄ Compara: 1.0.0 < 1.0.1? SIM! ‚úì
   
10. HomePage monta com UpdateBanner vis√≠vel:
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ‚ö†Ô∏è  Atualiza√ß√£o Dispon√≠vel           ‚úï  ‚îÇ
    ‚îÇ                                          ‚îÇ
    ‚îÇ Atualize para a vers√£o 1.0.1 agora     ‚îÇ
    ‚îÇ                                          ‚îÇ
    ‚îÇ üìù O que mudou:                          ‚îÇ
    ‚îÇ ‚Ä¢ Corre√ß√£o de crash ao fazer upload     ‚îÇ
    ‚îÇ                                          ‚îÇ
    ‚îÇ [  Depois  ]  [  Atualizar Agora  ]    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    
11. Usu√°rio clica "Atualizar Agora"
    ‚îî‚îÄ Abre link Play Store
    ‚îî‚îÄ Android abre Play Store app
    ‚îî‚îÄ Bot√£o "INSTALAR/ATUALIZAR"
    ‚îî‚îÄ Download + instala√ß√£o autom√°tica
    ‚îî‚îÄ App reinicia com vers√£o 1.0.1 ‚úì
    
12. Pr√≥xima abertura (vers√£o 1.0.1):
    ‚îî‚îÄ Compara: 1.0.1 < 1.0.1? N√ÉO
    ‚îî‚îÄ Banner N√ÉO aparece ‚úì
```

### Cen√°rio 2: Usu√°rio Ignora Notifica√ß√£o

```
11. Usu√°rio clica "Depois"
    ‚îî‚îÄ Banner dismissido por 12 horas
    ‚îî‚îÄ Continua usando app normalmente (SEM BLOQUEIO)
    
12. Reabertura em < 12h:
    ‚îî‚îÄ Banner N√ÉO aparece (cache)
    
13. Reabertura em > 12h:
    ‚îî‚îÄ Per√≠odo de dismiss√£o expirou
    ‚îî‚îÄ Banner aparece novamente ‚úì
```

### Cen√°rio 3: Voc√™ Quer Marcar como Cr√≠tica

```
Situa√ß√£o: Descobriu bug cr√≠tico de seguran√ßa

Solu√ß√£o (1 minuto):
1. Firebase Console ‚Üí app-config/version
2. Muda: isCritical: false ‚Üí true
3. Salva
4. Pr√≥xima verifica√ß√£o: Banner fica VERMELHO com "Atualizar Obrigat√≥ria"
   (Futuro v1.1: pode for√ßar bloqueio)
```

---

## üìã Timeline Real: Exemplo Pr√°tico

```
üìÖ SEXTA-FEIRA 14:00 - Voc√™ est√° desenvolvendo
‚îú‚îÄ Descobre: crash ao fazer upload de foto
‚îú‚îÄ Corrige o bug localmente
‚îî‚îÄ Testa no emulador ‚Üí OK ‚úì

üìÖ SEXTA-FEIRA 14:15 - Voc√™ faz commit
‚îú‚îÄ git commit -m "fix: corrige crash ao fazer upload"
‚îú‚îÄ git push
‚îú‚îÄ GitHub: cria PR
‚îî‚îÄ Reviewer aprova
‚îî‚îÄ Merge na main

üìÖ SEXTA-FEIRA 14:18 - GitHub Actions dispara
‚îú‚îÄ ü§ñ Tira seu caf√©...
‚îî‚îÄ CI/CD rodando (autom√°tico)

üìÖ SEXTA-FEIRA 14:23 - Automa√ß√£o completa!
‚îú‚îÄ ‚úÖ Build passou
‚îú‚îÄ ‚úÖ semantic-release: vers√£o 1.0.0 ‚Üí 1.0.1
‚îú‚îÄ ‚úÖ CHANGELOG.md gerado
‚îú‚îÄ ‚úÖ APK/AAB buildado
‚îú‚îÄ ‚úÖ Firebase atualizado
‚îî‚îÄ üéâ Tudo pronto!

üìÖ SEXTA-FEIRA 14:24 - Usu√°rio abre app
‚îú‚îÄ V√™: "Atualiza√ß√£o Dispon√≠vel - v1.0.1"
‚îú‚îÄ Clica: "Atualizar Agora"
‚îî‚îÄ Baixa v1.0.1 ‚úì

üìÖ SEXTA-FEIRA 14:30
‚îú‚îÄ üéâ Usu√°rio tem bug corrigido
‚îú‚îÄ üéâ Voc√™ n√£o fez nada manualmente
‚îî‚îÄ üéâ Tudo autom√°tico!
```

---

## üì± Fluxo do Usu√°rio (UX Flow) - Detalhado

---

## üß™ Requisitos de Testes

### Testes Unit√°rios: `useAppVersion.spec.ts`

```typescript
describe('useAppVersion', () => {
  // Testes de Compara√ß√£o
  describe('compareVersions', () => {
    it('deve retornar true quando v1 < v2')
    it('deve retornar false quando v1 >= v2')
    it('deve lidar com vers√µes de diferentes tamanhos (1.0 vs 1.0.0.0)')
  })
  
  // Testes de Computados
  describe('isOutdated', () => {
    it('deve retornar true quando currentVersion < minimumVersion')
    it('deve retornar false quando n√£o h√° minimumVersion')
  })
  
  describe('hasUpdateAvailable', () => {
    it('deve retornar true quando currentVersion < latestVersion')
  })
  
  // Testes de M√©todos
  describe('fetchVersionConfig', () => {
    it('deve buscar config do Firestore com sucesso')
    it('deve tratar erro ao buscar do Firestore')
    it('deve setar loading=true durante requisi√ß√£o')
  })
})
```

### Testes Unit√°rios: `appVersion.spec.ts`

```typescript
describe('appVersionStore', () => {
  describe('shouldCheckVersion', () => {
    it('deve retornar true quando lastCheckTime=null')
    it('deve retornar true quando passou 24h')
    it('deve retornar false quando passou < 24h')
  })
  
  describe('isBannerDismissed', () => {
    it('deve retornar true quando dentro do per√≠odo de dismiss√£o')
    it('deve retornar false quando fora do per√≠odo')
  })
  
  describe('dismissBanner', () => {
    it('deve setar dismissedUntil para agora + 12h')
  })
})
```

### Testes de Componente: `UpdateBanner.spec.ts`

```typescript
describe('UpdateBanner.vue', () => {
  describe('Renderiza√ß√£o', () => {
    it('deve renderizar quando isOutdated=true e !isBannerDismissed')
    it('n√£o deve renderizar quando isBannerDismissed=true')
    it('deve exibir vers√£o correta no texto')
  })
  
  describe('Intera√ß√µes', () => {
    it('deve abrir Play Store ao clicar "Atualizar Agora"')
    it('deve dismissir banner ao clicar "Depois"')
    it('deve dismissir banner ao clicar ‚úï')
  })
  
  describe('Anima√ß√µes', () => {
    it('deve animar entrada com slide-down')
    it('deve animar sa√≠da com slide-down')
  })
})
```

### Testes E2E (Manual - Checklist)

- [ ] Verificar se banner aparece ao abrir app com atualiza√ß√£o dispon√≠vel
- [ ] Verificar se "Atualizar Agora" abre Play Store corretamente
- [ ] Verificar se "Depois" dismissir banner por 12h
- [ ] Verificar se reabertura em < 12h n√£o mostra banner
- [ ] Verificar se reabertura em > 12h mostra banner novamente
- [ ] Verificar se closebutton (‚úï) dismissir banner
- [ ] Verificar se Firestore atualizado reflete no app ap√≥s 24h
- [ ] Verificar se offline n√£o quebra app

---

## üìã Checklist de Aceita√ß√£o

### Requisitos Funcionais
- [ ] Sistema verifica vers√£o ao abrir app
- [ ] Banner aparece quando app desatualizado
- [ ] Clique em "Atualizar" abre Play Store
- [ ] Clique em "Depois" dismissir por 12h
- [ ] Verifica√ß√£o peri√≥dica a cada 24h funciona
- [ ] Composable retorna vers√£o correta do env
- [ ] Compara√ß√£o sem√¢ntica de vers√µes funciona
- [ ] Firestore atualizada reflete no app

### Requisitos de Design
- [ ] Banner segue padr√£o visual da ProfilePage
- [ ] Gradiente e glassmorphism aplicados
- [ ] Espa√ßamento grid 8px mantido
- [ ] Tipografia consistente
- [ ] √çcones usando ionicons
- [ ] Cores usando CSS variables

### Requisitos T√©cnicos
- [ ] TypeScript strict mode sem erros
- [ ] Testes unit√°rios com cobertura > 80%
- [ ] Sem console errors/warnings
- [ ] Performance: <= 50ms para verifica√ß√£o
- [ ] Sem memory leaks
- [ ] ESLint passing
- [ ] Build sem erros

### Requisitos de Documenta√ß√£o
- [ ] README.md com instru√ß√µes de setup
- [ ] Coment√°rios no c√≥digo explicando l√≥gica
- [ ] Types TypeScript bem documentados
- [ ] Firestore schema documentado
- [ ] Exemplos de uso no composable

---

## üöÄ Implementa√ß√£o Passo a Passo

### Fase 1: Setup da Automa√ß√£o (1-2h)

#### 1.1 Instalar Depend√™ncias

```powershell
pnpm add -D semantic-release @semantic-release/changelog @semantic-release/git @semantic-release/exec
pnpm add -D firebase-admin
```

#### 1.2 Criar Arquivos de Configura√ß√£o

**Arquivos a criar:**
- `.releaserc.json` - Configura√ß√£o semantic-release
- `scripts/update-version.js` - Atualiza vers√£o local
- `scripts/publish-version.js` - Publica no Firebase
- `.github/workflows/release.yml` - GitHub Actions workflow

(Todos fornecidos acima na se√ß√£o "Arquitetura do CI/CD")

#### 1.3 Configurar GitHub Secrets

```
FIREBASE_SERVICE_ACCOUNT_JSON  # Chave Firebase (base64)
ANDROID_PACKAGE_ID             # "com.garagem.inteligente"
```

### Fase 2: Frontend (Componentes & L√≥gica) (4-6h)

1. Criar `src/types/version.ts`
2. Criar `src/composables/useAppVersion.ts`
3. Criar `src/stores/appVersion.ts`
4. Criar `src/views/home-page/components/UpdateBanner.vue`
5. Integrar em `App.vue` e `HomePage.vue`

### Fase 3: Testes (2-3h)

1. Testes unit√°rios composable
2. Testes unit√°rios store
3. Testes unit√°rios componente
4. Testes E2E manual

### Fase 4: Valida√ß√£o (1h)

1. Type-check: `pnpm type-check`
2. Lint: `pnpm lint`
3. Build: `pnpm build`
4. Teste piloto: fazer merge piloto e validar automa√ß√£o

---

## üìä O Que Muda Para Voc√™

| Aspecto | Antes | Depois |
|--------|-------|--------|
| **Ap√≥s merge PR** | üü° Atualiza Firestore manualmente | ü§ñ Autom√°tico em < 5min |
| **Atualiza√ß√£o de vers√£o** | üü° Manual em arquivo | ü§ñ semantic-release calcula |
| **Changelog** | üü° Voc√™ escreve | ü§ñ Gerado de commits |
| **Build Android** | üü° Semissemiautom√°tico | ü§ñ Totalmente autom√°tico |
| **Notifica√ß√£o Firestore** | üü° Voc√™ escreve | ü§ñ Scripts fazem tudo |
| **Tempo total** | ~15-20min manual | ~5min autom√°tico |
| **Erro humano** | Alto (vers√£o errada, esquecer) | Zero (100% autom√°tico) |
| **Frequ√™ncia de releases** | Semanal/mensal | Toda mudan√ßa importante |

---

## ‚úÖ Checklist de Implementa√ß√£o

### Setup CI/CD (Antes de qualquer c√≥digo)
- [ ] Instalar `semantic-release` e plugins
- [ ] Criar `.releaserc.json`
- [ ] Criar `scripts/update-version.js`
- [ ] Criar `scripts/publish-version.js`
- [ ] Criar `.github/workflows/release.yml`
- [ ] Configurar GitHub Secrets
- [ ] Validar arquivo `src/version.json`

### Frontend - Tipos
- [ ] Criar `src/types/version.ts`
- [ ] Interface `VersionConfig`
- [ ] Interface `AppVersionState`

### Frontend - Composable
- [ ] Criar `src/composables/useAppVersion.ts`
- [ ] Implementar `fetchVersionConfig()`
- [ ] Implementar `compareVersions()`
- [ ] Implementar `openPlayStore()`
- [ ] Testes do composable

### Frontend - Store
- [ ] Criar `src/stores/appVersion.ts`
- [ ] State: dismissedUntil, lastCheckTime
- [ ] Getters: isBannerDismissed, shouldCheckVersion
- [ ] Actions: initVersionCheck, dismissBanner
- [ ] Testes do store

### Frontend - Componente
- [ ] Criar `src/views/home-page/components/UpdateBanner.vue`
- [ ] Template com banner
- [ ] Estilos (glassmorphism, gradiente)
- [ ] L√≥gica de dismiss√£o
- [ ] Abertura Play Store
- [ ] Testes do componente

### Frontend - Integra√ß√£o
- [ ] Integrar em `App.vue` (onMounted)
- [ ] Integrar em `HomePage.vue` (renderizar banner)
- [ ] Testar com Firestore local

### Valida√ß√£o Final
- [ ] `pnpm type-check` - Sem erros
- [ ] `pnpm lint` - Sem avisos
- [ ] `pnpm build` - Sem erros
- [ ] Merge piloto & validar automa√ß√£o CI/CD
- [ ] Teste E2E: banner aparece com vers√£o nova
- [ ] Teste E2E: "Atualizar Agora" abre Play Store
- [ ] Teste E2E: "Depois" dismissir banner 12h

---

## üìä M√©tricas de Sucesso

| M√©trica | Meta | Crit√©rio | Como Medir |
|---------|------|----------|-----------|
| **Ado√ß√£o de Vers√£o** | > 80% em 7 dias | Rastreamento via Firebase | Analytics Firestore |
| **Performance CI/CD** | < 5 min total | Sem impacto em produ√ß√£o | GitHub Actions logs |
| **Automatiza√ß√£o** | 100% | Zero interven√ß√£o manual | Hist√≥rico de CI/CD |
| **Cobertura de Testes** | > 85% | Todas funcionalidades | Coverage reports |
| **Tempo de Desenvolvimento** | 10-12h | 2 sprints | Timeline real |
| **User Satisfaction** | > 4.0/5 | N√£o-intrusivo | App reviews |
| **Releases por Semana** | 3-5+ | Frequ√™ncia aumenta | GitHub releases |

---

## üéØ Pr√≥ximas A√ß√µes Recomendadas

### Imediatamente (Antes de Come√ßar)
1. ‚úÖ Ler este PRD completamente
2. ‚úÖ Entender fluxo de automa√ß√£o CI/CD
3. ‚úÖ Verificar todos os GitHub Secrets necess√°rios
4. ‚úÖ Validar acesso ao Firebase

### Sprint 1 (1-2 semanas)
1. üèóÔ∏è Setup CI/CD (semantic-release + GitHub Actions)
2. üèóÔ∏è Implementar tipos TypeScript
3. üèóÔ∏è Implementar composable + store
4. üèóÔ∏è Criar componente UpdateBanner
5. üèóÔ∏è Integrar em App.vue e HomePage
6. üèóÔ∏è Testes unit√°rios

### Sprint 2 (1 semana)
1. üß™ Testes E2E completos
2. üß™ Valida√ß√£o de automa√ß√£o CI/CD
3. üß™ Release piloto (vers√£o de teste)
4. üß™ Monitoramento em produ√ß√£o
5. üìö Documenta√ß√£o de opera√ß√£o

### Futuro (v1.1+)
1. üîí Force update para vers√µes cr√≠ticas
2. üì± Suporte para App Store (iOS)
3. üìä Analytics detalhadas de atualiza√ß√£o
4. üåê Rollout gradual por percentual
5. üîî Notifica√ß√µes push via FCM

---

## ÔøΩ Refer√™ncias & Suporte

### üìö Documenta√ß√µes Essenciais
- [SEMANTIC_RELEASE_SETUP.md](../setup/SEMANTIC_RELEASE_SETUP.md) - **Setup r√°pido de CI/CD** ‚≠ê
- [Firebase Firestore](https://firebase.google.com/docs/firestore)
- [Ionic Vue](https://ionicframework.com/docs/vue)
- [Semantic Versioning](https://semver.org/)
- [Pinia State Management](https://pinia.vuejs.org/)
- [Conventional Commits](https://www.conventionalcommits.org/)

### üîó Links Importantes
- Play Store App: `https://play.google.com/store/apps/details?id=com.garagem.inteligente`
- Firebase Console: `https://console.firebase.google.com/`
- Repository: `https://github.com/Garagem-Inteligente/client-app`

### üÜò Contatos
- **Tech Lead:** [Seu Nome]
- **Product Manager:** [PM Nome]
- **Designer:** [Designer Nome]

---

## ‚úÖ Aprova√ß√£o

| Papel | Nome | Data | Assinatura |
|------|------|------|-----------|
| **Product Manager** | - | - | ‚úì |
| **Tech Lead** | - | - | ‚úì |
| **Designer** | - | - | ‚úì |
| **QA Lead** | - | - | ‚úì |

---

## üó∫Ô∏è Estrutura de Documenta√ß√£o

```
docs/
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ prds/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ APP_UPDATE_NOTIFICATION_PRD.md ‚Üê Voc√™ est√° aqui
‚îÇ   ‚îî‚îÄ‚îÄ setup/
‚îÇ       ‚îî‚îÄ‚îÄ SEMANTIC_RELEASE_SETUP.md ‚Üê Setup r√°pido CI/CD
‚îî‚îÄ‚îÄ ...
```

---

**Documento vers√£o 2.0 - Outubro 2025**  
**Status:** Automatiza√ß√£o Completa via CI/CD  
**√öltimo atualizado:** 24 de outubro de 2025
